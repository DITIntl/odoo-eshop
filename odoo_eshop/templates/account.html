{% extends 'base_account.html' %}

{% block container_account %}
<script>
    $('#nav_account_account').addClass('active');
</script>

<h1>{{ _('Your Account') }}</h1>
<form class="form-horizontal" role="form" method="POST" action="{{ url_for('account_update') }}">
    <fieldset disabled>
        <div class="form-group">
            <label for="account_name" class="col-sm-2 control-label">{{ _('Complete Name') }}</label>
            <div class="col-sm-8">
                <input type="text" class="form-control account_data" 
                    id="account_name"
                    name="new_name" value="{{ partner.name }}">
            </div>
            <div class="clearfix visible-sm-block"></div>
            <label for="account_email" class="col-sm-2 control-label">{{ _('Email') }}</label>
            <div class="col-sm-8">
                <input type="text" class="form-control account_data" 
                    id="account_email"
                    name="new_email" value="{{ partner.email|empty_if_null }}">
            </div>
            <div class="clearfix visible-sm-block"></div>
        </div>
      </fieldset>

    <div class="form-group">
        <label for="account_phone" class="col-sm-2 control-label">{{ _('Phone') }}</label>
        <div class="col-sm-2">
            <input type="text" class="form-control account_data" 
                id="account_phone"
                name="new_phone" value="{{ partner.phone|empty_if_null }}">
        </div>
        <div class="clearfix visible-sm-block"></div>
        <label for="account_mobile" class="col-sm-2 control-label">{{ _('Cell Phone') }}</label>
        <div class="col-sm-2">
            <input type="text" class="form-control account_data" 
                id="account_mobile"
                name="new_mobile" value="{{ partner.mobile|empty_if_null }}">
        </div>
    </div>

    <div class="form-group">
        <label for="account_street" class="col-sm-2 control-label">{{ _('Street') }}</label>
        <div class="col-sm-10">
            <input type="text" class="form-control account_data" 
                id="account_street"
                name="new_street" value="{{ partner.street|empty_if_null }}">
        </div>
        <div class="clearfix visible-sm-block"></div>
        <label for="account_street2" class="col-sm-2 control-label">{{ _('Complement Street') }}</label>
        <div class="col-sm-10">
            <input type="text" class="form-control account_data" 
                id="account_street2"
                name="new_street2" value="{{ partner.street2|empty_if_null }}">
        </div>
        <div class="clearfix visible-sm-block"></div>
        <label for="account_zip" class="col-sm-2 control-label">{{ _('ZIP') }}</label>
        <div class="col-sm-2">
            <input type="text" class="form-control account_data" 
                id="account_zip"
                name="new_zip" value="{{ partner.zip|empty_if_null }}">
        </div>
        <div class="clearfix visible-sm-block"></div>
        <label for="account_city" class="col-sm-2 control-label">{{ _('City') }}</label>
        <div class="col-sm-4">
            <input type="text" class="form-control account_data" 
                id="account_city"
                name="new_city" value="{{ partner.city|empty_if_null }}">
        </div>
        <div class="clearfix visible-sm-block"></div>
    </div>

    <div class="form-group">
        <div class="col-sm-offset-2 col-sm-10">
            <button type="submit" class="btn btn-default update_btn">{{ _('Update')}}</button>
        </div>
    </div>
</form>

<!-- JQuery -->
<script>
    $('.update_btn').hide();
    $('.update_btn').attr('disabled', 'disabled');

    $('.account_data').change(function(e){
        self = this;
        $.ajax({
            url: "{{ url_for('account_update') }}",
            type: "POST",
            data: {
                new_phone: $('#account_phone').val(),
                new_mobile: $('#account_mobile').val(),
                new_street: $('#account_street').val(),
                new_street2: $('#account_street2').val(),
                new_zip: $('#account_zip').val(),
                new_city: $('#account_city').val(),
                }, timeout: 1000,
        }).done(function(msg){
            if (msg.result.state == 'success' || msg.result.state == 'warning'){
                $('#account_phone').val(msg.result.phone);
                $('#account_mobile').val(msg.result.mobile);
                $('#account_street').val(msg.result.street);
                $('#account_street2').val(msg.result.street2);
                $('#account_zip').val(msg.result.zip);
                $('#account_city').val(msg.result.city);
            }
//            if (msg.result.state != 'success') {
            $('.flashes').replaceWith("<div class='flashes'><p class='text-center bg-" + msg.result.state + "'>" + msg.result.message  + "</p></div>");
//            }
//            else {
//                $('.flashes').replaceWith("<div class='flashes' />");
//            }
        }).fail(function(xhr, textstatus){
            $('.flashes').replaceWith("<div class='flashes'><p class='text-center bg-danger'> {{ _('Something wrong occured, please refresh the page.')}}</p></div>");
        });


    });
</script>

{% endblock %}
